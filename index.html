<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Interactive Portfolio â€” Orbit Animation</title>
<style>
  html,body{
    height:100%;
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    /* Force cursor everywhere, even beyond content bounds */
    cursor:url('assets/cursor.png') 16 16, auto !important;
  }

  body{
    display:flex;
    align-items:center;
    justify-content:center;
    background-image:url('assets/background.png');
    background-size:cover;
    background-position:center;
    overflow:hidden;
  }

  * {
    /* ensure every element inherits cursor */
    cursor:inherit !important;
  }

  .stage{
    position:relative;
    width:80vmin;
    height:80vmin;
    display:flex;
    align-items:center;
    justify-content:center;
    transition:transform 0.4s ease;
  }

  .folder-btn{
    position:relative;
    background:transparent;
    border:none;
    display:flex;
    align-items:center;
    justify-content:center;
    animation:float 3s ease-in-out infinite;
    transition:transform .25s ease;
    z-index:10;
    width:48vmin;
    height:48vmin;
    padding:0;
  }
  @keyframes float{
    0%{transform:translateY(0)}
    50%{transform:translateY(-1.2vmin)}
    100%{transform:translateY(0)}
  }
  .folder-btn img{
    width:100%;
    height:100%;
    object-fit:contain;
    filter:drop-shadow(0 0.6vmin 1.2vmin rgba(0,0,0,0.4));
    transition:opacity 0.25s ease;
    display:block;
  }

  .orbit-container{
    position:absolute;
    inset:0;
  }

  .orbiter{
    position:absolute;
    left:50%;
    top:50%;
    background:transparent;
    border:none;
    opacity:0;
    transform:translate(0,0) scale(0.8);
    transition:opacity 0.25s ease, transform 0.3s ease;
    z-index:5;
    padding:0;
  }
  .orbiter img{
    width:100%;
    height:100%;
    object-fit:contain;
    filter:drop-shadow(0 0.8vmin 1.2vmin rgba(0,0,0,0.45));
    display:block;
    pointer-events:none;
  }

  .hover-sign{
    position:absolute;
    top:-40%;
    left:50%;
    transform:translateX(-50%);
    width:50%;
    height:auto;
    opacity:0;
    transition:opacity 0.25s ease, transform 0.25s ease;
    pointer-events:none;
  }
  .orbiter:hover .hover-sign{
    opacity:1;
    transform:translateX(-50%) translateY(-5%);
  }

  .folder-btn,
  .folder-btn *,
  .orbiter,
  .orbiter * {
    cursor:url('assets/handcursor.png') 16 16, pointer !important;
  }

  /* --- Shared overlay for popups --- */
  #overlay {
    position:fixed;
    inset:0;
    background-color:rgba(0,60,0,0.6);
    opacity:0;
    pointer-events:none;
    transition:opacity 0.4s ease;
    z-index:90;
  }
  #overlay.visible {
    opacity:1;
    pointer-events:auto;
  }

  /* --- Resume Popup --- */
  #resumeImagePopup {
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%) scale(0.5);
    opacity:0;
    max-width:100vw;
    max-height:95vh;
    display:inline-block;
    z-index:100;
    transition:opacity 0.45s ease-in-out, transform 0.45s ease-in-out;
    pointer-events:none;
  }
  #resumeImagePopup.visible {
    opacity:1;
    transform:translate(-50%,-50%) scale(1);
    pointer-events:auto;
  }
  #resumeImagePopup.fly-away {
    opacity:0;
    transform:translate(-50%,-48%) scale(0.9);
    pointer-events:none;
  }
  #resumeImagePopup img{
    max-width:100%;
    max-height:92vh;
    min-width:480px;
    width:auto;
    height:auto;
    object-fit:contain;
    display:block;
    cursor:url('assets/cursor.png') 16 16, auto !important; /* normal cursor inside image */
  }
  #resumeClose{
    top:-2vmin;
    right:-2vmin;
  }

  @media (max-width:750px){
    #resumeImagePopup{
      --resume-mobile-margin:0.1vw;          /* side margin on small screens */
      max-width:calc(200vw - (var(--resume-mobile-margin) * 2));
    }
  }

#resumeDownloadBtn {
  position:fixed;
  bottom:1.5%;
  left:75%;
  transform:translateX(-50%) scale(0.9);
  opacity:0;
  z-index:101;
  background:transparent;
  border:none;
  padding:0;
  transition:opacity 0.4s ease, transform 0.4s ease;
  pointer-events:none; /* Disable all clicks when hidden */
}

#resumeDownloadBtn img {
  width:calc(12vmin * 3);
  height:auto;
  object-fit:contain;
  filter:brightness(1.06) drop-shadow(0 0.6vmin 1.2vmin rgba(0,0,0,0.5));
  transition:transform 0.2s ease;
}
#resumeDownloadBtn:hover {
  transform:translateX(-50%) scale(1.05);
}
#resumeDownloadBtn.visible {
  opacity:1;
  transform:translateX(-50%) scale(1);
  pointer-events:auto; /* Reactivate clicks only when visible */
  cursor:url('assets/handcursor.png') 16 16, pointer !important;
}

  /* --- Award Certificate Popup (no download button) --- */
  #awardImagePopup {
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%) scale(0.5);
    opacity:0;
    max-width:95vw;
    max-height:90vh;
    z-index:100;
    transition:opacity 0.45s ease-in-out, transform 0.45s ease-in-out;
    pointer-events:none;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:url('assets/cursor.png') 16 16, auto !important; /* normal cursor inside image */
  }
  #awardImagePopup.visible {
    opacity:1;
    transform:translate(-50%,-50%) scale(1);
    pointer-events:auto;
  }
  #awardImagePopup.fly-away {
    top:-30%;
    opacity:0;
    transform:translate(-50%,-50%) scale(0.4);
    pointer-events:none;
  }

  .award-card{
    position:relative;
    display:inline-block;
  }

  #awardImagePopup img{
    width:100%;
    height:auto;
    display:block;
    pointer-events:none;
  }
    /* --- Photography Viewer --- */
  #photoViewer {
    position:fixed;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    background-color:rgba(0,60,0,0.6);
    opacity:0;
    pointer-events:none;
    transition:opacity 0.4s ease;
    z-index:100;
  }
  #photoViewer.visible {
    opacity:1;
    pointer-events:auto;
  }

  .photo-frame{
    position:relative;
    display:inline-flex;
    justify-content:center;
    align-items:center;
    margin-bottom:5vmin;
  }
  #photoImage {
    max-width:80vw;
    max-height:75vh;
    object-fit:contain;
    transition:opacity 0.3s ease;
    display:block;
  }
  #photoClose{
    top:-2vmin;
    right:-2.5vmin;
  }

  #photoControls {
  position:fixed;                     /* stay fixed at bottom of screen */
  bottom:1vmin;                       /* distance from bottom edge */
  left:50%;                           /* center horizontally */
  transform:translateX(-50%);
  display:flex;
  justify-content:center;
  align-items:center;
  gap:5vmin;
  z-index:102;                        /* above photos/grid */
  pointer-events:auto;
}

  #photoControls button {
    background:transparent;
    border:none;
    padding:0;
  }

  #photoViewer.visible #photoControls button{
    cursor:url('assets/handcursor.png') 16 16, pointer !important;
  }

  #photoControls img {
    width:16vmin;
    height:auto;
    filter:drop-shadow(0 0.6vmin 1.2vmin rgba(0,0,0,0.5));
    transition:transform 0.25s ease;
    pointer-events:none; /* keep button cursor consistent */
    cursor:inherit;
  }

  #photoControls button:hover img {
    transform:scale(1.1);
  }

  #photoControls button:disabled{
    cursor:url('assets/cursor.png') 16 16, auto !important;
  }

  #photoControls button:disabled img{
    opacity:0.35;
    transform:none;
  }

  .podcast-player{
    position:fixed;
    top:58%;
    left:50%;
    transform:translate(-50%,-50%) scale(0.95);
    width:min(85vw,680px);
    --badge-scale:0.5;                  /* Controls badge width relative to player width */
    --badge-top:-40%;                    /* Badge offset from player box (Y) */
    --badge-left:-4.5%;                     /* Badge offset from player box (X) */
    background:rgba(0,60,0,0.88);
    border-radius:18px;
    border:1px solid rgba(255,255,255,0.08);
    box-shadow:0 1.6vmin 3vmin rgba(0,0,0,0.35);
    padding:3vmin 3vmin 2.5vmin;
    transition:opacity 0.35s ease, transform 0.35s ease;
    opacity:0;
    pointer-events:none;
    z-index:120;
    overflow:visible;                    /* allow badge to float above window */
    cursor:url('assets/cursor.png') 16 16, auto !important;
  }

  .podcast-player.visible{
    opacity:1;
    transform:translate(-50%,-50%) scale(1);
    pointer-events:auto;
  }

  .podcast-player .player-badge{
    position:absolute;
    top:var(--badge-top);
    left:var(--badge-left);
    transform:translate(-50%,-50%);
    width:clamp(180px, calc(var(--badge-scale) * 100%), 260px);
    overflow:visible;                    /* allow badge to float above window */
    height:auto;
    pointer-events:none;
    animation:float 3s ease-in-out infinite;
    filter:drop-shadow(0 1vmin 1.8vmin rgba(0,0,0,0.35));
    z-index:160;
  }

  .podcast-content{
    max-height:unset;
    overflow:hidden;                    /* hide scrollbars on larger screens */
  }

  .window-close-btn{
    position:absolute;
    width:4.4vmin;
    height:4.4vmin;
    background:transparent url('assets/window-close.png') center/contain no-repeat;
    border:none;
    cursor:url('assets/x-cursor.png') 16 16, pointer !important;
    transition:transform 0.2s ease;
    z-index:200;
    padding:0;
    filter:drop-shadow(0 0.6vmin 1vmin rgba(0,0,0,0.55));
  }

  .window-close-btn:hover{
    transform:scale(1.08);
  }

  .window-close-btn:focus-visible{
    outline:2px solid rgba(255,255,255,0.8);
    outline-offset:3px;
  }

  #podcastClose{
    top:1.1vmin;
    right:0.8vmin;
  }

  #awardClose{
    top:1vmin;
    right:1vmin;
  }

  #podcastPlayer iframe{
    width:100% !important;
    height:min(60vh,420px);
    border:0;
    border-radius:12px;
    scrollbar-width:none;
    overflow:hidden;
  }

  .podcast-player::-webkit-scrollbar,
  #podcastPlayer iframe::-webkit-scrollbar{
    display:none;
  }

  /* Desktop: keep scrollbars hidden */
  @media (min-width:751px){
    .podcast-content{
      max-height:unset;
      overflow:hidden;
    }
    #podcastPlayer iframe{
      overflow:hidden;
      scrollbar-width:none;
    }
    #podcastPlayer iframe::-webkit-scrollbar{
      display:none;
    }
  }

  /* Grid view */
/* Allow page-level scrolling of the gallery even when not directly over thumbnails */
  #photoViewer.grid {
  overflow: hidden; /* disable all scrolling */
  }

  #photoViewer.grid #photoImage {
    display:none;
  }
  #photoViewer.grid #photoClose{
    display:none;
  }

  #photoViewer.grid::before {
    content:"";
    position:absolute;
    inset:10%;
    display:grid;
    grid-template-columns:repeat(4,1fr);
    grid-template-rows:repeat(4,1fr);
    gap:1vmin;
    background:transparent;
  }

.grid-container {
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  align-items:flex-start;
  overflow:hidden;             /* enables vertical scrolling */
  margin: 6vmin auto 16vmin;         /* top/side/bottom spacing (bottom clears controls) */
  padding: 0;                        /* padding handled by viewer margins now */
  gap: 1vmin;                        /* ðŸ‘ˆ smaller margin between thumbnails */
  box-sizing: border-box;
  pointer-events: auto;          /* ensures the grid scroll area receives wheel events */
  opacity:0;
  transform:translateY(3vmin);
  transition:opacity 0.35s ease, transform 0.35s ease;
}

.grid-container.visible{
  opacity:1;
  transform:translateY(0);
}

.grid-container img {
  width:18vmin;                /* thumbnail size */
  height:18vmin;
  object-fit:cover;
  border-radius:6px;
  transition:transform 0.2s ease;
  cursor:url('assets/handcursor.png') 16 16, pointer !important;
}

.grid-container img:hover {
  transform:scale(1.05);
}

  @media (max-width:750px){
    .podcast-player{
      width:90vw;
      padding:4vmin 4vmin 3vmin;
    }

    .podcast-content{
      max-height:88vh;
      overflow-y:auto;                   /* allow scrolling on small viewports */
      overflow-x:visible;
      -webkit-overflow-scrolling:touch;
      scrollbar-width:auto;
      scrollbar-color:rgba(255,255,255,0.35) transparent;
      -ms-overflow-style:auto;
    }

    #podcastClose{
      width:6.6vmin;
      height:6.6vmin;
    }

    #podcastPlayer iframe{
      height:min(65vh,360px);
      overflow:auto;
    }

    .podcast-content::-webkit-scrollbar{
      display:block !important;          /* override desktop hidden scrollbar */
      width:8px;
    }

    .podcast-content::-webkit-scrollbar-thumb{
      background:rgba(255,255,255,0.35);
      border-radius:10px;
    }

    .podcast-content::-webkit-scrollbar-track{
      background:rgba(255,255,255,0.08);
    }

    #podcastPlayer iframe::-webkit-scrollbar{ width:8px; }
    #podcastPlayer iframe::-webkit-scrollbar-thumb{ background:rgba(255,255,255,0.35); border-radius:10px; }
    #podcastPlayer iframe::-webkit-scrollbar-track{ background:rgba(255,255,255,0.08); }
  }
</style>
</head>
<body>
  <div class="stage" id="stage">
    <button id="folder" class="folder-btn" aria-label="Open folder">
      <img id="folderImage" src="assets/folder.png" alt="Folder icon">
    </button>
    <div class="orbit-container" id="orbit"></div>
  </div>

  <!-- Shared dark green overlay -->
  <div id="overlay"></div>

  <!-- Resume popup -->
  <div id="resumeImagePopup">
    <img id="resumeImage" src="assets/resumeimage.png" alt="Resume full image" />
    <button id="resumeClose" class="window-close-btn" aria-label="Close resume image"></button>
  </div>

  <!-- Award certificate popup -->
  <div id="awardImagePopup" role="dialog" aria-label="Award certificate">
    <div class="award-card">
      <img src="assets/award-certificate.png" alt="Award certificate image">
      <button id="awardClose" class="window-close-btn" aria-label="Close award certificate"></button>
    </div>
  </div>

  <!-- Resume download button (kept for resume only) -->
  <button id="resumeDownloadBtn">
    <img src="assets/resume-download.png" alt="Download Resume">
  </button>

  <!-- Podcast player -->
  <div id="podcastPlayer" class="podcast-player" aria-hidden="true">
    <img class="player-badge" src="assets/podcast-player.png" alt="Podcast icon">
    <button id="podcastClose" class="window-close-btn" aria-label="Hide podcast player"></button>
    <div class="podcast-content">
      <iframe allow="autoplay *; encrypted-media *; fullscreen *; clipboard-write" frameborder="0" height="450" scrolling="auto" style="width:100%;max-width:660px;overflow:auto;border-radius:10px;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="https://embed.podcasts.apple.com/us/podcast/peking-hotel-with-liu-he/id1748271770"></iframe>
    </div>
  </div>

  <!-- Photography viewer popup -->
  <div id="photoViewer">
    <div class="photo-frame">
      <button id="photoClose" class="window-close-btn" aria-label="Close photo viewer"></button>
      <img id="photoImage" src="" alt="Photo viewer">
    </div>
    <div id="photoControls">
      <button id="photoPrev"><img src="assets/left-index.png" alt="Previous"></button>
      <button id="photoGrid"><img src="assets/gallery.png" alt="Gallery"></button>
      <button id="photoNext"><img src="assets/right-index.png" alt="Next"></button>
    </div>
  </div>
<script>

const orbitItems=[
  {name:'Social Media', file:'assets/social.png', url:'https://www.canva.com/design/DAGXg344xEM/2MgSCJpfdI5IKko544yXAQ/view'},
  {name:'Awards',       file:'assets/awards.png', url:'#'}, /* overridden to popup */
  {name:'Podcasts',     file:'assets/podcasts.png', url:null},
  {name:'Writings',     file:'assets/writings.png', url:'https://muckrack.com/aoruipi'},
  {name:'Photography',  file:'assets/photography.png', url:'https://aurorapiaorui.wixsite.com/api100/photo'},
  {name:'Resume',       file:'assets/resume.png', url:'#'} /* popup */
];

const stage=document.getElementById('stage');
const folder=document.getElementById('folder');
const folderImage=document.getElementById('folderImage');
const orbit=document.getElementById('orbit');

const overlay=document.getElementById('overlay');

const resumeImagePopup=document.getElementById('resumeImagePopup');
const resumeClose=document.getElementById('resumeClose');
const resumeDownloadBtn=document.getElementById('resumeDownloadBtn');

const awardImagePopup=document.getElementById('awardImagePopup');
const awardClose=document.getElementById('awardClose');
const awardImage=document.querySelector('#awardImagePopup img');
const awardCard=document.querySelector('#awardImagePopup .award-card');
const podcastPlayer=document.getElementById('podcastPlayer');
const podcastClose=document.getElementById('podcastClose');

let expanded=false, rafId=null, startTime=null;
let rotationSpeed=0.02;
let radius=0;
let resumeActive=false;
let awardActive=false;
let podcastActive=false;
let photoActive=false;
let photoIndex=0;
let galleryMode=false;
let gridContainer=null;
let photoLoadId=0;
let lastPointer=null;
const podcastIframe=document.querySelector('#podcastPlayer iframe');

const folderClosedImage='assets/folder.png';
const folderOpenImage='assets/folder-open.png';
const CURSOR_DEFAULT=`url('assets/cursor.png') 16 16, auto`;
const CURSOR_HAND=`url('assets/handcursor.png') 16 16, pointer`;
const CURSOR_CLOSE=`url('assets/x-cursor.png') 16 16, auto`;

/* Create orbiters */
const orbiters=orbitItems.map(cfg=>{
  const el=document.createElement('button');
  el.className='orbiter';
  el.setAttribute('aria-label',cfg.name);
  el.innerHTML=`<img src="${cfg.file}" alt="${cfg.name}">
    <img class="hover-sign" src="assets/${cfg.name.toLowerCase().replace(/\s/g,'')}-sign.png" alt="${cfg.name} sign">`;

  el.addEventListener('click',e=>{
    e.stopPropagation();
    if(!expanded || resumeActive || awardActive) return;

  if(cfg.name==='Resume'){
  triggerResumeMode();
} else if(cfg.name==='Awards'){
  triggerAwardMode();
} else if(cfg.name==='Photography'){
  triggerPhotoMode();
} else if(cfg.name==='Podcasts'){
  triggerPodcastMode();
} else {
  const newWin=window.open(cfg.url,'_blank','noopener,noreferrer');
  if(newWin) newWin.opener=null;
}
  });

  orbit.appendChild(el);
  return el;
});

/* --- MODE HANDLERS --- */
function collapseOrbitersForModal(){
  closePodcastPlayer({skipExpand:true});
  orbiters.forEach(el=>{
    el.style.transform='translate(0,0) scale(0.5)';
    el.style.opacity='0';
  });
  if(rafId) cancelAnimationFrame(rafId);
  expanded=false;
  folderImage.src=folderClosedImage;
}

function triggerPodcastMode(){
  if(podcastActive) return;
  collapseOrbitersForModal();
  setTimeout(()=>openPodcastPlayer(),400);
}

function openPodcastPlayer(){
  if(podcastActive) return;
  podcastActive=true;
  overlay.classList.add('visible');
  podcastPlayer.classList.add('visible');
  podcastPlayer.setAttribute('aria-hidden','false');
  applyModalCursor();
}

function closePodcastPlayer({skipExpand=false}={}){
  if(!podcastActive) return;
  podcastActive=false;
  podcastPlayer.classList.remove('visible');
  podcastPlayer.setAttribute('aria-hidden','true');
  if(!resumeActive && !awardActive){
    overlay.classList.remove('visible');
    if(!skipExpand){
      setTimeout(()=>{
        if(!resumeActive && !awardActive && !expanded){
          expand();
        }
      },350);
    }
  }
  applyModalCursor();
}

function triggerResumeMode(){
  resumeActive=true;
  collapseOrbitersForModal();
  setTimeout(()=>{
    overlay.classList.add('visible');
    resumeImagePopup.classList.add('visible');
    resumeDownloadBtn.classList.add('visible');
    resumeDownloadBtn.disabled = false; // enable again
    applyModalCursor();
  },400);
}

function triggerAwardMode(){
  awardActive = true;
  collapseOrbitersForModal();
  setTimeout(() => {
    overlay.classList.add('visible');
    awardImagePopup.classList.add('visible');
    resumeDownloadBtn.classList.remove('visible');
    resumeDownloadBtn.disabled = true; // disable while award active
    applyModalCursor();
  }, 400);
}

/* --- Photography Mode --- */
const photoViewer=document.getElementById('photoViewer');
const photoImage=document.getElementById('photoImage');
const photoPrev=document.getElementById('photoPrev');
const photoNext=document.getElementById('photoNext');
const photoGrid=document.getElementById('photoGrid');
const photoControls=document.getElementById('photoControls');
const photoClose=document.getElementById('photoClose');

function triggerPhotoMode(){
  photoActive=true;
  collapseOrbitersForModal();
  exitGalleryMode({instant:true});
  photoIndex=1;
  showPhoto(photoIndex);
  setTimeout(()=>{
    photoViewer.classList.add('visible');
    applyModalCursor();
  },400);
}

function showPhoto(index){
  const newSrc=`assets/photo${index}.jpg`;
  const loadId=++photoLoadId;
  photoImage.style.opacity='0';

  const tempImage=new Image();
  const revealImage=()=>{
    if(loadId!==photoLoadId) return;
    photoImage.src=newSrc;
    requestAnimationFrame(()=>photoImage.style.opacity='1');
  };

  tempImage.onload=revealImage;
  tempImage.onerror=revealImage;
  tempImage.src=newSrc;
}

function setNavButtonsState(enabled){
  photoPrev.disabled=!enabled;
  photoNext.disabled=!enabled;
}

function buildGrid(){
  gridContainer=document.createElement('div');
  gridContainer.className='grid-container';
  for(let i=1;i<=16;i++){
    const img=document.createElement('img');
    img.src=`assets/photo${i}.jpg`;
    img.addEventListener('click',e=>{
      e.stopPropagation();
      exitGalleryMode({
        onComplete:()=>{
          photoIndex=i;
          showPhoto(photoIndex);
        }
      });
    });
    gridContainer.appendChild(img);
  }
  photoViewer.appendChild(gridContainer);
  requestAnimationFrame(()=>gridContainer.classList.add('visible'));
}

function enterGalleryMode(){
  if(galleryMode) return;
  galleryMode=true;
  setNavButtonsState(false);
  photoViewer.classList.add('grid');
  buildGrid();
}

function exitGalleryMode({instant=false,onComplete=null}={}){
  const finish=()=>{
    photoViewer.classList.remove('grid','grid-leaving');
    galleryMode=false;
    setNavButtonsState(true);
    onComplete?.();
  };

  if(!gridContainer){
    finish();
    return;
  }

  const target=gridContainer;

  if(instant){
    target.remove();
    gridContainer=null;
    finish();
    return;
  }

  photoViewer.classList.add('grid-leaving');
  target.classList.remove('visible');
  target.style.pointerEvents='none';

  let done=false;
  const cleanup=()=>{
    if(done) return;
    done=true;
    target.remove();
    if(gridContainer===target) gridContainer=null;
    finish();
  };

  target.addEventListener('transitionend',cleanup,{once:true});
  setTimeout(cleanup,450);
}

function closePhotoViewer(){
  if(!photoActive) return;
  exitGalleryMode({instant:true});
  gridContainer?.remove();
  gridContainer=null;
  photoViewer.classList.remove('visible','grid','grid-leaving');
  photoActive=false;
  applyModalCursor();
  expanded=false;
  folderImage.src=folderClosedImage;
  setTimeout(()=>{
    if(!resumeActive && !awardActive){
      expand();
    }
  },350);
}

/* Controls */
photoPrev.addEventListener('click',e=>{
  e.stopPropagation();
  if(galleryMode) return;
  photoIndex = photoIndex <= 1 ? 16 : photoIndex - 1;
  showPhoto(photoIndex);
});

photoNext.addEventListener('click',e=>{
  e.stopPropagation();
  if(galleryMode) return;
  photoIndex = photoIndex >= 16 ? 1 : photoIndex + 1;
  showPhoto(photoIndex);
});

photoGrid.addEventListener('click',e=>{
  e.stopPropagation();
  if(galleryMode){
    exitGalleryMode({onComplete:()=>showPhoto(photoIndex)});
  } else {
    enterGalleryMode();
  }
});

photoClose.addEventListener('click',e=>{
  e.stopPropagation();
  closePhotoViewer();
});

/* Close viewer when clicking outside */
photoViewer.addEventListener('click', e => {
  const insideControls=photoControls && photoControls.contains(e.target);
  if(insideControls) return;

  if(galleryMode){
    if(gridContainer && gridContainer.contains(e.target)) return;
    closePhotoViewer();
    return;
  }

  if(photoImage.contains(e.target)) return;
  closePhotoViewer();
});

function closeResumePopup(){
  if(!resumeActive) return;
  resumeActive=false;
  resumeDownloadBtn.classList.remove('visible');
  overlay.classList.remove('visible');
  document.body.style.cursor = CURSOR_DEFAULT;
  playFlyAway(resumeImagePopup);
  applyModalCursor();
  setTimeout(()=>{
    expanded=false;            // ensure one-click restart
    folderImage.src=folderClosedImage;
    if(!podcastActive && !photoActive && !awardActive){
      expand();
    }
  },520);
}

function closeAwardPopup(){
  if(!awardActive) return;
  awardActive=false;
  overlay.classList.remove('visible');
  document.body.style.cursor = CURSOR_DEFAULT;
  playFlyAway(awardImagePopup);
  applyModalCursor();
  setTimeout(()=>{
    expanded=false;            // ensure one-click restart
    folderImage.src=folderClosedImage;
    if(!podcastActive && !photoActive && !resumeActive){
      expand();
    }
  },520);
}

function playFlyAway(el){
  if(!el) return;
  let handler=null;
  const cleanup=(e)=>{
    if(e && e.target!==el) return;
    el.classList.remove('fly-away','visible');
    if(handler) el.removeEventListener('transitionend',handler);
  };
  handler=cleanup;
  el.classList.add('fly-away');
  el.addEventListener('transitionend',handler,{once:true});
  setTimeout(cleanup,520);
}

function updateAwardImageSize(){
  if(!awardImage) return;
  const viewportWidth=window.innerWidth;
  const viewportHeight=window.innerHeight;
  const maxWidth=viewportWidth*0.95;
  const maxHeight=viewportHeight*0.9;
  const baseSize=Math.min(viewportWidth*0.5, viewportHeight*0.65);
  const scaledSize=Math.min(baseSize*1.6, maxWidth);
  awardImage.style.width=scaledSize+"px";
  awardImage.style.maxHeight=maxHeight+"px";
  awardImage.style.height='auto';
}

/* --- ORBIT LOGIC --- */
function updateSizes(){
  const stageRect=stage.getBoundingClientRect();
  const folderRect=folder.getBoundingClientRect();
  const folderSize=Math.min(folderRect.width,folderRect.height);
  radius=Math.min(stageRect.width,stageRect.height)*0.42;
  const orbSize=folderSize*0.66;
  orbiters.forEach(el=>{
    el.style.width=orbSize+"px";
    el.style.height=orbSize+"px";
    el.style.marginLeft=-(orbSize/2)+"px";
    el.style.marginTop=-(orbSize/2)+"px";
  });
}
function animate(time){
  if(!expanded) return;
  if(!startTime) startTime=time;
  const t=(time-startTime)/1000;
  orbiters.forEach((el,i)=>{
    const angle=(i/orbiters.length)*Math.PI*2+t*rotationSpeed;
    const x=Math.cos(angle)*radius;
    const y=Math.sin(angle)*radius;
    el.style.transform=`translate(${x}px,${y}px) scale(1)`;
    el.style.opacity='1';
  });
  rafId=requestAnimationFrame(animate);
}
function expand(){
  if(expanded) return;
  expanded=true;
  folderImage.src=folderOpenImage;
  updateSizes();
  orbiters.forEach(el=>{el.style.opacity='1';el.style.zIndex='15';});
  startTime=null;
  rafId=requestAnimationFrame(animate);
}
function collapse(){
  if(!expanded) return;
  expanded=false;
  closePodcastPlayer();
  folderImage.src=folderClosedImage;
  orbiters.forEach(el=>{
    el.style.opacity='0';
    el.style.transform='translate(0,0) scale(0.8)';
    el.style.zIndex='5';
  });
  if(rafId) cancelAnimationFrame(rafId);
}

/* --- EVENTS --- */
folder.addEventListener('click',e=>{
  e.stopPropagation();
  if(resumeActive || awardActive || podcastActive) return;
  expanded?collapse():expand();
});

/* Close whichever modal is open by clicking overlay */
overlay.addEventListener('click',()=>{
  if(resumeActive){
    closeResumePopup();
    return;
  }
  if(awardActive){
    closeAwardPopup();
    return;
  }
  if(podcastActive){
    closePodcastPlayer();
  }
});

awardClose.addEventListener('click',e=>{
  e.stopPropagation();
  closeAwardPopup();
});

podcastClose.addEventListener('click',e=>{
  e.stopPropagation();
  closePodcastPlayer();
});

/* Resume Download button (resume only) */
resumeDownloadBtn.addEventListener('click',e=>{
  e.stopPropagation();
  const newTab=window.open('assets/Aorui-Resume.pdf','_blank','noopener,noreferrer');
  if(newTab){ newTab.opener=null; }
});

resumeClose.addEventListener('click',e=>{
  e.stopPropagation();
  closeResumePopup();
});

/* Cursor logic across resume, award, podcast, and photo overlays */
function isPointerInside(el,x,y){
  if(!el) return false;
  const rect=el.getBoundingClientRect();
  return x>=rect.left && x<=rect.right && y>=rect.top && y<=rect.bottom;
}

function applyModalCursor(){
  const resumeVisible=resumeActive && resumeImagePopup.classList.contains('visible');
  const awardVisible=awardActive && awardImagePopup.classList.contains('visible');
  const podcastVisible=podcastActive && podcastPlayer.classList.contains('visible');
  const photoVisible=photoActive && photoViewer.classList.contains('visible');

  if(!resumeVisible && !awardVisible && !podcastVisible && !photoVisible){
    document.body.style.cursor=CURSOR_DEFAULT;
    return;
  }

  if(!lastPointer){
    document.body.style.cursor=CURSOR_CLOSE;
    return;
  }

  const {x,y}=lastPointer;
  const insideDownload=resumeDownloadBtn.classList.contains('visible') && isPointerInside(resumeDownloadBtn,x,y);
  const insideResume=resumeVisible && isPointerInside(resumeImagePopup,x,y);
  const insideAward=awardVisible && isPointerInside(awardCard || awardImagePopup,x,y);
  const insidePodcast=podcastVisible && isPointerInside(podcastPlayer,x,y);
  const insidePhotoImage=photoVisible && isPointerInside(photoImage,x,y);
  const insidePhotoControls=photoVisible && isPointerInside(photoControls,x,y);
  const insidePhotoGrid=photoVisible && gridContainer && isPointerInside(gridContainer,x,y);

  if(insideDownload){
    document.body.style.cursor=CURSOR_HAND;
  } else if(
    insideResume ||
    insideAward ||
    insidePodcast ||
    insidePhotoImage ||
    insidePhotoControls ||
    insidePhotoGrid
  ){
    document.body.style.cursor=CURSOR_DEFAULT;
  } else {
    document.body.style.cursor=CURSOR_CLOSE;
  }
}

function handlePointerMove(e){
  lastPointer={x:e.clientX,y:e.clientY};
  applyModalCursor();
}

document.addEventListener('mousemove',handlePointerMove);

function handleResize(){
  updateSizes();
  updateAwardImageSize();
  updatePodcastScrollbar();
}

window.addEventListener('resize',handleResize);
handleResize();

function updatePodcastScrollbar(){
  if(!podcastIframe) return;
  const isMobile=window.innerWidth<=750;
  const content=document.querySelector('.podcast-content');
  podcastIframe.setAttribute('scrolling', isMobile ? 'auto' : 'no');
  podcastIframe.style.overflow=isMobile ? 'auto' : 'hidden';
  podcastIframe.style.webkitOverflowScrolling=isMobile ? 'touch' : 'auto';
  if(content){
    content.style.maxHeight=isMobile ? '88vh' : 'unset';
    content.style.overflowY=isMobile ? 'auto' : 'hidden';
    content.style.overflowX='visible';
  }
}
</script>
</body>
</html>
